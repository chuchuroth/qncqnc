version: '3.8'

services:
  # Gripper Control - Publisher (connects to gripper via RS485)
  gripper-control:
    image: modbus-rtu-protocol:neurasync
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gripper-control
    devices:
      - /dev/ttyUSB0:/dev/ttyUSB0
    network_mode: host
    environment:
      - FASTRTPS_DEFAULT_PROFILES_FILE=/dev/null
    command: ["gripper_control", "/dev/ttyUSB0", "1", "115200", "gripper_01"]
    restart: unless-stopped

  # Gripper Dashboard - Subscriber (displays gripper state)
  gripper-dashboard:
    image: modbus-rtu-protocol:neurasync
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gripper-dashboard
    network_mode: host
    environment:
      - FASTRTPS_DEFAULT_PROFILES_FILE=/dev/null
    command: ["gripper_dashboard"]
    restart: unless-stopped
    depends_on:
      - gripper-control

  # Basic ModbusRTU example (no NeuraSync)
  modbus-example:
    image: modbus-rtu-protocol:neurasync
    build:
      context: .
      dockerfile: Dockerfile
    container_name: modbus-example
    devices:
      - /dev/ttyUSB0:/dev/ttyUSB0
    command: ["modbus_rtu_example", "/dev/ttyUSB0", "1"]
    profiles:
      - example
